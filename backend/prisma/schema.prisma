// prisma/schema.prisma

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL") // app_prod prin pooler (runtime)
  directUrl = env("DIRECT_URL") // migrator_prod (DOAR pentru migrate/Studio)
}

generator client {
  provider = "prisma-client-js"
}

/**
 * ==================== Enums ====================
 */

enum Role {
  USER
  VENDOR
  ADMIN
}

enum ServiceStatus {
  DRAFT
  ACTIVE
  INACTIVE
}

enum EventType {
  PAGEVIEW
  CTA_CLICK
  MESSAGE

  VIEW_START
  VIEW_PING
  VIEW_END
}

enum VerifyIntent {
  USER
  VENDOR
}

/**
 * ==================== User & Auth ====================
 */

model User {
  id           String @id @default(uuid())
  email        String @unique
  passwordHash String

  tokenVersion Int @default(0)

  // Nume normalizat
  firstName String?
  lastName  String?

  // Legacy full name (compatibilitate)
  name String?

  role      Role     @default(USER)
  createdAt DateTime @default(now())

  // Consim»õƒÉminte / conformitate
  marketingOptIn  Boolean   @default(false)
  termsAcceptedAt DateTime?

  emailVerifiedAt         DateTime?
  emailVerificationTokens EmailVerificationToken[]

  // Rela»õii
  vendor Vendor?

  passwordResetTokens PasswordResetToken[]
  Favorite            Favorite[]
  passwordHistories   PasswordHistory[]

  // inverse
  reviews       Review[]
  comments      Comment[]
  cartItems     CartItem[]
  UserConsent   UserConsent[]
  ReviewHelpful ReviewHelpful[]
  ReviewReport  ReviewReport[]

  supportTickets  SupportTicket[] // requester -> tickets deschise de user
  supportMessages SupportMessage[] // author   -> mesaje trimise de user
  supportReads    SupportRead[] // mark-as-read pe tichete
  MessageThread   MessageThread[]
  Message         Message[]
  Notification    Notification[]
}

model PasswordResetToken {
  id        String    @id @default(uuid())
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  tokenHash String    @unique
  createdAt DateTime  @default(now())
  expiresAt DateTime
  usedAt    DateTime?

  @@index([userId, expiresAt])
}

model PasswordHistory {
  id           String   @id @default(cuid())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId       String
  passwordHash String
  createdAt    DateTime @default(now())

  @@index([userId, createdAt])
}

model EmailVerificationToken {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  tokenHash String    @unique
  purpose   String    @default("verify_email")
  createdAt DateTime  @default(now())
  expiresAt DateTime
  usedAt    DateTime?

  intent VerifyIntent @default(USER)

  @@index([userId, expiresAt])
  @@index([purpose])
}

/**
 * ==================== Vendor & Billing ====================
 */

model Vendor {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @unique

  // Profil public (vizibil √Æn marketplace)
  displayName String
  city        String?
  category    String?
  about       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  logoUrl  String?
  coverUrl String?
  phone    String?
  email    String?
  website  String?
  socials  Json?
  address  String?
  delivery String[]

  // 1‚Äì1: date de facturare (nepublice)
  billing VendorBilling?

  // Rela»õii servicii/abonamente
  services      VendorService[]
  subscriptions VendorSubscription[]

  visitors         Visitor[]
  events           Event[]
  searches         Search[]
  VendorAcceptance VendorAcceptance[]
  ReviewReply      ReviewReply[]

  // === Support back-relations ===
  supportTickets SupportTicket[] // tichete asociate vendorului (op»õional)
  MessageThread  MessageThread[]
  Notification   Notification[]
}

model VendorBilling {
  id       String @id @default(uuid())
  vendor   Vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  vendorId String @unique

  legalType     String
  vendorName    String
  companyName   String
  cui           String
  regCom        String
  address       String
  iban          String
  bank          String
  email         String
  contactPerson String
  phone         String

  tvaActive     Boolean?
  tvaVerifiedAt DateTime?
  tvaSource     String?
  anafName      String?
  anafAddress   String?

  tvaRegStart DateTime? // data_inceput_ScpTva
  tvaRegEnd   DateTime? // data_anul_imp_ScpTva
  inactiv     Boolean?
  inactivFrom DateTime?
  insolvent   Boolean?
  splitTva    Boolean?
  anafPayload Json? // payload-ul brut ANAF (debug / audit)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([cui])
  @@index([email])
}

model RequestLog {
  idempotencyKey String   @id
  responseJson   Json
  createdAt      DateTime @default(now())

  @@map("request_logs")
}

/**
 * ==================== Catalog servicii ====================
 */

model ServiceType {
  id        String   @id @default(uuid())
  code      String   @unique
  name      String
  fields    Json?
  createdAt DateTime @default(now())

  vendorServices VendorService[]
}

model VendorService {
  id       String      @id @default(uuid())
  vendor   Vendor      @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  vendorId String
  type     ServiceType @relation(fields: [typeId], references: [id])
  typeId   String

  title          String?
  description    String?
  basePriceCents Int?
  currency       String   @default("EUR")
  city           String?
  coverageAreas  String[]
  mediaUrls      String[]
  attributes     Json?

  profile  ServiceProfile?
  products Product[]

  status    ServiceStatus @default(DRAFT)
  isActive  Boolean       @default(false)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@unique([vendorId, typeId], name: "vendor_type_unique")
  @@index([vendorId, typeId])
}

model ServiceProfile {
  id        String        @id @default(uuid())
  service   VendorService @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceId String        @unique

  displayName String?
  slug        String?  @unique
  logoUrl     String?
  coverUrl    String?
  phone       String?
  email       String?
  website     String?
  socials     Json?
  address     String?
  delivery    String[]
  about       String?
  city        String?

  // scurtƒÉ descriere sub nume (nou)
  shortDescription String? @db.VarChar(160)

  // pƒÉstrezi »ôi tagline dacƒÉ vrei (op»õional)
  tagline String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/**
 * ==================== Subscriptions ====================
 */
// === Enums noi / actualizate ===
enum PlanInterval {
  month
  year
}

enum SubscriptionStatus {
  pending
  active
  canceled
  canceled_at_period_end
  past_due
  unpaid
  expired
}

// === Subscriptions ===
model SubscriptionPlan {
  id         String       @id @default(uuid())
  code       String       @unique
  name       String
  priceCents Int
  currency   String       @default("RON")
  interval   PlanInterval @default(month)
  features   String[]
  isActive   Boolean      @default(true)
  popular    Boolean      @default(false) // op»õional, util pentru UI
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  subscriptions VendorSubscription[]

  @@index([isActive, priceCents])
}

model VendorSubscription {
  id       String           @id @default(uuid())
  vendor   Vendor           @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  vendorId String
  plan     SubscriptionPlan @relation(fields: [planId], references: [id])
  planId   String

  status  SubscriptionStatus @default(pending)
  startAt DateTime           @default(now())
  endAt   DateTime // obligatoriu: codul tƒÉu depinde de el
  extRef  String? // idempotency key sau id subs de la provider
  meta    Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([vendorId, status, endAt]) // folosit la requireActiveSubscription
  @@index([extRef])
}

enum ProductAvailability {
  READY          // gata de livrare
  MADE_TO_ORDER  // la comandƒÉ (execu»õie)
  PREORDER       // precomandƒÉ
  SOLD_OUT       // epuizat, dar pƒÉstrat public
}

model Product {
  id        String        @id @default(uuid())
  service   VendorService @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceId String

  title       String
  description String?
  priceCents  Int
  currency    String   @default("RON")
  images      String[]
  isActive    Boolean  @default(true)

  // op»õional
  category String? @db.VarChar(64)
  color    String? @db.VarChar(32) // culoare principalƒÉ

  // === handmade / disponibilitate ===
  availability         ProductAvailability @default(READY)
  leadTimeDays         Int?                              // pentru MADE_TO_ORDER
  readyQty             Int?                @default(0)   // bucƒÉ»õi gata de livrare
  acceptsCustom        Boolean             @default(false)
  nextShipDate         DateTime?                        // pentru PREORDER
  limitedEditionOf     Int?
  limitedEditionNumber Int?
  isHidden             Boolean             @default(false)

  // === detalii structurate pentru descriere mai bogatƒÉ ===
  materialMain      String?   @db.VarChar(120)  // ex: lemn de pin, ceramicƒÉ
  technique         String?   @db.VarChar(160)  // ex: pictat manual
  styleTags         String[]                     // ex: ["rustic","minimalist"]
  occasionTags      String[]                     // ex: ["cadou casƒÉ nouƒÉ"]
  dimensions        String?   @db.VarChar(120)   // ex: 20 x 30 cm
  careInstructions  String?                      // text liber
  specialNotes      String?                      // ce √Æl face special

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Favorite Favorite[]

  reviews            Review[]
  comments           Comment[]
  cartItems          CartItem[]
  ProductRatingStats ProductRatingStats[]

  @@index([serviceId, isActive, createdAt])
  @@index([category])
  @@index([isHidden, isActive, availability, createdAt])
}


model Favorite {
  userId    String
  productId String
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@id([userId, productId])
  @@index([userId, createdAt])
  @@index([createdAt, productId]) // pt. cursor pagination
}

/**
 * ==================== Reviews / Comments / Cart ====================
 */
model Review {
  id        String       @id @default(uuid())
  product   Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  rating    Int
  comment   String?
  verified  Boolean      @default(false)
  status    ReviewStatus @default(APPROVED)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  helpful ReviewHelpful[]
  reply   ReviewReply?
  reports ReviewReport[]

  @@unique([productId, userId], name: "productId_userId")
  @@index([productId, status])
  @@index([userId])
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
}

model ReviewHelpful {
  id        String   @id @default(cuid())
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  reviewId  String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  createdAt DateTime @default(now())

  @@unique([reviewId, userId])
  @@index([userId, createdAt])
}

model ReviewReply {
  id        String   @id @default(cuid())
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  reviewId  String   @unique
  vendor    Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  vendorId  String
  text      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ReviewReport {
  id         String   @id @default(cuid())
  review     Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  reviewId   String
  reporter   User     @relation(fields: [reporterId], references: [id], onDelete: Cascade)
  reporterId String
  reason     String
  createdAt  DateTime @default(now())

  @@index([reviewId, createdAt])
}

model ProductRatingStats {
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String   @id
  avg       Decimal  @db.Decimal(4, 2) // ex: 4.35
  c1        Int      @default(0)
  c2        Int      @default(0)
  c3        Int      @default(0)
  c4        Int      @default(0)
  c5        Int      @default(0)
  updatedAt DateTime @updatedAt
}

model Comment {
  id        String   @id @default(uuid())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  text      String
  parentId  String? // thread scurt (op»õional)
  createdAt DateTime @default(now())

  @@index([productId])
  @@index([userId])
}

model CartItem {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Restrict)
  productId String
  qty       Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, productId], name: "userId_productId")
  @@index([userId])
}

model Visitor {
  id       String @id @default(uuid())
  vendor   Vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  vendorId String

  // Context (op»õionale)
  productId String?
  source    String?
  ref       String?

  city      String?
  ipHash    String?
  userAgent String?

  note      String?
  contacted Boolean @default(false)

  createdAt DateTime @default(now())

  @@index([vendorId, createdAt])
  @@index([vendorId, contacted])
}

model Event {
  id        String    @id @default(cuid())
  vendorId  String
  type      EventType
  createdAt DateTime  @default(now())
  pageUrl   String?
  ctaLabel  String?
  referrer  String?
  sessionId String?
  userAgent String?
  viewId    String?
  Vendor    Vendor    @relation(fields: [vendorId], references: [id])

  @@index([vendorId, createdAt])
  @@index([vendorId, type, createdAt])
  @@index([vendorId, pageUrl, createdAt]) // üëà util pt top-pages & avg time
  @@index([vendorId, sessionId, viewId, createdAt])
}

model Search {
  id        String   @id @default(cuid())
  vendorId  String
  query     String
  hits      Int      @default(1)
  createdAt DateTime @default(now())
  Vendor    Vendor   @relation(fields: [vendorId], references: [id])

  @@index([vendorId, createdAt])
}

enum ConsentDoc {
  TOS
  PRIVACY_ACK
  MARKETING_EMAIL_OPTIN
}

model UserConsent {
  id       String     @id @default(cuid())
  user     User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId   String
  document ConsentDoc
  version  String
  checksum String?
  givenAt  DateTime   @default(now())
  ip       String?
  ua       String?

  @@index([userId, document])
}

enum VendorDoc {
  VENDOR_TERMS
  SHIPPING_ADDENDUM
  RETURNS_POLICY_ACK
}

// --- NOU: tabel cu versiunile publicate ale documentelor legale ---
model VendorPolicy {
  id          String    @id @default(cuid())
  document    VendorDoc
  title       String
  url         String
  version     String // ex: "3" sau "3.1"
  checksum    String? // ex: sha256 pdf/html
  isRequired  Boolean   @default(true)
  isActive    Boolean   @default(true)
  publishedAt DateTime  @default(now())

  @@unique([document, version])
  @@index([document, isActive])
}

// --- UPDATE (op»õional, ca sƒÉ pƒÉstrƒÉm istoric de acceptƒÉri) ---
model VendorAcceptance {
  id         String    @id @default(cuid())
  vendor     Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  vendorId   String
  document   VendorDoc
  version    String
  checksum   String?
  acceptedAt DateTime  @default(now())

  // vechiul index unic era: @@unique([vendorId, document], name: "vendorId_document")
  // √Æl √Ænlocuim cu:
  @@unique([vendorId, document, version], name: "vendorId_document_version")
  @@index([vendorId, document, acceptedAt])
}

enum OrderStatus {
  PENDING
  PAID
  CANCELLED
  FULFILLED
}

enum ShipmentStatus {
  PENDING
  AWB
  IN_TRANSIT
  DELIVERED
  RETURNED
  PREPARING // nou
  READY_FOR_PICKUP // nou
  PICKUP_SCHEDULED // nou
}

enum PaymentMethod {
  COD // ramburs
  CARD // online
}

enum ShippingMethod {
  COURIER
  LOCKER
}

model Order {
  id              String        @id @default(cuid())
  userId          String
  status          OrderStatus   @default(PENDING)
  paymentMethod   PaymentMethod
  currency        String        @default("RON")
  subtotal        Decimal       @db.Decimal(10, 2)
  shippingTotal   Decimal       @db.Decimal(10, 2)
  total           Decimal       @db.Decimal(10, 2)
  shippingAddress Json
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  shipments Shipment[]

  @@index([userId, createdAt])
}

model Shipment {
  id       String         @id @default(cuid())
  orderId  String
  vendorId String
  method   ShippingMethod @default(COURIER)
  lockerId String?
  price    Decimal        @default(0) @db.Decimal(10, 2)
  status   ShipmentStatus @default(PREPARING) // nou: √Æncepem cu PREPARING

  // curier
  courierProvider String? // ex: "Sameday", "FanCourier"
  courierService  String? // ex: "standard24h"
  awb             String?
  labelUrl        String?
  trackingUrl     String?

  // pick-up
  pickupDate        DateTime?
  pickupSlotStart   DateTime?
  pickupSlotEnd     DateTime?
  pickupScheduledAt DateTime?

  // consim»õƒÉminte & detalii colet
  consents Json? // stocƒÉm ce a bifat vendorul
  parcels  Int? // nr colete
  weightKg Decimal? @db.Decimal(7, 2)
  lengthCm Int?
  widthCm  Int?
  heightCm Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  order Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)
  items ShipmentItem[]

  @@index([orderId])
  @@index([vendorId])
  @@index([status, pickupDate])
}

model ShipmentItem {
  id         String  @id @default(cuid())
  shipmentId String
  productId  String
  title      String
  qty        Int
  price      Decimal @db.Decimal(10, 2) // pre»õ unitar √Æn momentul comenzii

  shipment Shipment @relation(fields: [shipmentId], references: [id], onDelete: Cascade)

  @@index([shipmentId])
  @@index([productId])
}

// ==================== Support / Tickets ====================

enum TicketStatus {
  OPEN
  PENDING
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
}

model SupportTicket {
  id          String @id @default(cuid())
  // cine a deschis tichetul (obligatoriu)
  requester   User   @relation(fields: [requesterId], references: [id], onDelete: Cascade)
  requesterId String

  // op»õional: pentru tichetele venite de la furnizori (vendor dashboard)
  vendor   Vendor? @relation(fields: [vendorId], references: [id], onDelete: SetNull)
  vendorId String?

  subject  String
  category String         @default("general")
  status   TicketStatus   @default(OPEN)
  priority TicketPriority @default(MEDIUM)

  // pentru sortare rapidƒÉ √Æn listƒÉ
  lastMessageAt DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  messages    SupportMessage[]
  attachments SupportAttachment[]
  reads       SupportRead[]

  @@index([requesterId, status, updatedAt])
  @@index([vendorId, status, updatedAt])
  @@index([lastMessageAt])
}

model SupportMessage {
  id       String        @id @default(cuid())
  ticket   SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  ticketId String

  // "me" vs "them" √Æn UI: aici pƒÉstrƒÉm autorul
  author   User?   @relation(fields: [authorId], references: [id], onDelete: SetNull)
  authorId String?
  // pentru mesaje de sistem (ex: auto-replies)
  system   Boolean @default(false)

  body      String
  createdAt DateTime @default(now())

  // === Support back-relations ===
  attachments SupportAttachment[] // ata»ôamente legate de mesaj (op»õional)

  @@index([ticketId, createdAt])
}

model SupportAttachment {
  id        String          @id @default(cuid())
  ticket    SupportTicket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  ticketId  String
  message   SupportMessage? @relation(fields: [messageId], references: [id], onDelete: SetNull)
  messageId String?
  filename  String
  url       String
  mime      String?
  size      Int?
  createdAt DateTime        @default(now())

  @@index([ticketId, createdAt])
}

model SupportRead {
  // one row / (ticket, user) ‚Äì ultima citire
  ticket     SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  ticketId   String
  user       User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  lastReadAt DateTime      @default(now())

  @@id([ticketId, userId])
  @@index([userId, lastReadAt])
}

// FAQ simplu ‚Äì populƒÉm cu seed
model SupportFaq {
  id        String   @id @default(cuid())
  q         String
  a         String
  tags      String[]
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  @@index([isActive, createdAt])
}

/// ==================== Inbox / Messaging ====================

enum MessageAuthorType {
  VENDOR
  VISITOR // guest / lead anonim (nume/email/telefon)
  USER // user logat (op»õional)
}

model MessageThread {
  id String @id @default(cuid())

  // de cine apar»õine inbox-ul (artizanul)
  vendor   Vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  vendorId String

  // dacƒÉ vizitatorul e user logat, legƒÉm la User
  user   User?   @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId String?

  // fallback ‚Äûguest contact‚Äù (pentru leaduri ne√Ænregistrate)
  contactName  String?
  contactEmail String?
  contactPhone String?

  // status thread
  archived Boolean @default(false)

  // pentru listƒÉ
  lastMsg String?
  lastAt  DateTime? // c√¢nd a venit ultimul mesaj (din oricare parte)

  // citiri (pt calc. necitite)
  vendorLastReadAt  DateTime?
  visitorLastReadAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  messages Message[]

  @@index([vendorId, archived, lastAt])
  @@index([vendorId, lastAt])
  @@index([userId])
  @@index([contactEmail])
  @@index([contactPhone])
}

model Message {
  id       String        @id @default(cuid())
  thread   MessageThread @relation(fields: [threadId], references: [id], onDelete: Cascade)
  threadId String

  authorType   MessageAuthorType
  // dacƒÉ autorul e USER, √Æl putem lega (op»õional)
  authorUser   User?             @relation(fields: [authorUserId], references: [id], onDelete: SetNull)
  authorUserId String?

  authorName String? // pentru VISITOR (guest)
  body       String
  createdAt  DateTime @default(now())

  attachments MessageAttachment[]

  @@index([threadId, createdAt])
}

model MessageAttachment {
  id        String   @id @default(cuid())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  messageId String
  filename  String
  url       String
  mime      String?
  size      Int?
  createdAt DateTime @default(now())

  @@index([messageId])
}

// ==================== Notifications ====================

enum NotificationType {
  message
  order
  billing
  system
  email
}

model Notification {
  id String @id @default(cuid())

  // cui √Æi apar»õine notificarea (user din dashboard; pentru vendor dashboard userul este vendor.user)
  user   User?   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String?

  // op»õional, pentru claritate: legƒÉm »ôi vendor-ul
  vendor   Vendor? @relation(fields: [vendorId], references: [id], onDelete: SetNull)
  vendorId String?

  type  NotificationType @default(system)
  title String
  body  String?
  link  String? // ex: /dashboard/messages/123

  readAt   DateTime?
  archived Boolean   @default(false)

  meta Json? // extra info (orderId, ticketId etc.)

  createdAt DateTime @default(now())

  @@index([userId, createdAt])
  @@index([userId, readAt, archived])
  @@index([vendorId, createdAt])
}
